{% extends "base.html" %} {% load static %} {% block content %}

<link rel="stylesheet" href="{% static 'css/AdmCss/listaDeUsuarios.css'%}" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />

{% include "components/adm/menuAdm.html" %}

<div class="mainListaUsuarios">
  <div class="divPesquisa-listaDeUsuarios">
    <form id="searchForm" method="GET" action="{% url 'listaDeUsuarios' %}" class="barraPesquisa-listaDeUsuarios">
      <img src="{% static 'img/iconeLupa.png' %}" alt="Ícone de busca" />
      <input id="barraBusca-listaDeUsuarios" name="q" type="search" placeholder="Pesquisar usuário" value="{{ search_query|default:'' }}" />
    </form>
  </div>
  <div class="primeiraLinha-listaDeUsuarios">
    <h1><span>Usu</span>ários</h1>

    <div class="botoesUsuario-listaDeUsuarios">
      <button class="addMoedas-listaDeUsuarios" id="addMoedas">
        <img src="{% static 'img/iconAdicionar.png' %}" alt="" />
        Gerenciar digicoins
      </button>

      <button class="addUsuarios-listaDeUsuarios" id="addUsuarios">
        <img src="{% static 'img/iconAdicionar.png' %}" alt="" />
        Adicionar usuário
      </button>

      <button class="addUsuarios-listaDeUsuarios laranja-listaDeUsuarios" id="addUsuariosEmMassa">
        <img src="{% static 'img/iconAdicionar.png' %}" alt="" />
        Cadastrar usuários CSV
      </button>
    </div>
  </div>

  <div class="head-listaDeUsuarios">
    <div class="head-div-listaDeUsuarios">
      <p>Nome</p>
      <img src="{% static 'img/lista.png' %}" alt="" />
    </div>
    <button class="zerarPontuacao-listaDeUsuarios">
      <img src="{% static 'img/minus.png' %}" alt=""> Zerar Pontuação
    </button>
  </div>
  <dialog id="ZerarDialog">
    <div>
      <h2>Deseja zerar a pontuação de todos os usuários?</h2>
      <img src="{% static 'img/iconeX.png' %}" alt="Fechar" id="fecharZerarDialog">
    </div>
    <div class="botoes-zerar">
      <button id="confirmarBtn">Confirmar</button>
      <button id="cancelarZerar">Cancelar</button>
    </div>
  </dialog>

  <div class="selecionar-todos-listaDeUsuarios">
    <label>
      <input type="checkbox" id="selecionarTodos" />
      Selecionar todos os usuários ativos
    </label>
  </div>

  <div id="listaUsuarios" class="listaUsuarios">
    {% for usuario in usuarios %} {% if usuario.is_active %}

    <div class="linhaUsuario-listaDeUsuarios">
      <input type="checkbox" class="checkbox" />
      <div class="infoUser-listaDeUsuarios">
        <img src="{% static 'img/userBlack.png' %}" alt="" />
        <input type="hidden" class="idUser-listaDeUsuarios" value="{{usuario.id}}" />
        <span class="nome-listaDeUsuarios">{{usuario.first_name}}</span>
        <span class="pontuacao">D$ {{usuario.saldo}} </span>
        <span class="status-listaDeUsuarios"></span>
        <span class="pontos-listaDeUsuarios pontuacao" > {{usuario.pontuacao}} Pts </span>
      </div>
      <img class="iconeEditar-listaDeUsuarios" id="editar" data-id="{{usuario.id}}" src="{% static 'img/edit.png' %}" alt="" />
    </div>

    {% else %}

    <div class="linhaUsuario-listaDeUsuarios desativado-listaDeUsuarios">
      <input type="checkbox" class="checkbox" disabled />
      <div class="infoUser-listaDeUsuarios">
        <input type="text" class="idUser-listaDeUsuarios" value="{{usuario.id}}" />
        <img src="{% static 'img/userBlack.png' %}" alt="" />
        <span class="nome-listaDeUsuarios">{{usuario.first_name}}</span>
        <span class="status-listaDeUsuarios">Desativado</span>
      </div>
      <img class="iconeEditar-listaDeUsuarios" id="editar" data-id="{{usuario.id}}" src="{% static 'img/edit.png' %}" alt="" />
    </div>

    {% endif %}

    <dialog id="editarUsuario-{{usuario.id}}" data-id="{{usuario.id}}" class="editarUsuario">
      <header class="headerCentral-ListaDeUsuario">
        <div class="headerLogo-ListaDeUsuario">
          <img src="{% static "img/logoAdmin.png" %}" alt="LOGO">
        </div>
        <div class="headerBotao-ListaDeUsuario">
          <button type="button" class="buttonClose-ListaDeUsuario close-dialog">    
            <img alt="botãoClose" src="{% static "img/iconeX.png" %}">
          </button>
        </div>
      </header>
      <div class="ModalContainer-ListaDeUsuario">
        <form class="formEditar">
            {% csrf_token %}
            <input type="hidden" class="idUser" value="{{usuario.id}}" />

            <div class="form-group">
                <label for="nome-{{usuario.id}}" class="form-label">Nome do Usuário</label>
                <input type="text" id="nome-{{usuario.id}}" class="form-input nome" value="{{usuario.first_name}}" />
            </div>

            <div class="form-group">
                <label for="email-{{usuario.id}}" class="form-label">Email</label>
                <input type="email" id="email-{{usuario.id}}" class="form-input email" value="{{usuario.username}}" />
            </div>

            <div class="form-group">
                <label for="ra-{{usuario.id}}" class="form-label">RA do Usuário</label>
                <input type="number" id="ra-{{usuario.id}}" class="form-input ra" value="{{usuario.ra}}" onkeydown="return bloqueiaCaracteresIndesejados(event)"/>
            </div>

            <div class="form-group">
                <label class="form-label">Status do Usuário</label>
                <div class="radio-options-horizontal">
                    <div class="radio-item">
                        <input type="radio" id="status_ativo-{{usuario.id}}" name="is_active" value="true" {% if usuario.is_active %}checked{% endif %}>
                        <label for="status_ativo-{{usuario.id}}">Ativado</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="status_inativo-{{usuario.id}}" name="is_active" value="false" {% if not usuario.is_active %}checked{% endif %}>
                        <label for="status_inativo-{{usuario.id}}">Desativado</label>
                    </div>
                </div>
            </div>

            <div class="action-buttons">
                <button type="button" 
                        class="action-button alterarSenha" 
                        data-id="{{usuario.id}}" 
                        onclick="alterarSenha({{usuario.id}})">
                    Alterar senha
                </button>

                <button type="submit" class="action-button submit">
                    Salvar Alterações
                </button>
            </div>
        </form>
      </div>
    </dialog>

    {% endfor%}
  </div>
  <div class="pagination-listaDeUsuarios">
    {% if usuarios.has_previous %}
    <div>
      <a style="font-size: 20px; margin-right: 10px" href="?user_page={{ usuarios.previous_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}"><i class="fa fa-arrow-left" aria-hidden="true"></i></a>
    </div>
    {% endif %}

    <span>Página {{ usuarios.number }} de {{ usuarios.paginator.num_pages }}</span>

    {% if usuarios.has_next %}
    <div>
      <a style="font-size: 20px" href="?user_page={{ usuarios.next_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}"><i class="fa fa-arrow-right" aria-hidden="true"></i></a>
    </div>
    {% endif %}
  </div>
</div>

<dialog id="popupCadastrarUsuario" class="popupCadastrarUsuario">
  <header class="headerCentral-ListaDeUsuario">
      <div class="headerLogo-ListaDeUsuario">
          <img src="{% static "img/logoAdmin.png" %}" alt="LOGO">
      </div>
      <div class="headerBotao-ListaDeUsuario">
          <button type="button" class="buttonClose-ListaDeUsuario">    
              <img id="fecharCadastrar"  alt="botãoClose" src="{% static "img/iconeX.png" %}">
          </button>
      </div>
  </header>
  <div class="ModalContainer-ListaDeUsuario">
    <form method="POST" class="formUsuario-cadastrarUsuario" id="formUsuario">
      {% csrf_token %}
      <div class="input-cadastrarUsuario">
        <label for="">Nome do Usuário</label>
        <input type="text" id="nome" class="nome" placeholder="Digite o nome do usuário" />
      </div>

      <div class="input-cadastrarUsuario">
        <label for="">Email</label>
        <input type="email" id="email" class="email" placeholder="Digite seu email" />
      </div>

      <div class="input-cadastrarUsuario">
        <label for="">RA do Usuário</label>
        <input type="number" id="ra" class="ra" placeholder="Digite o ra" onkeydown="return bloqueiaCaracteresIndesejados(event)" />
      </div>

      <div class="input-cadastrarUsuario">
        <label for="">Senha temporária</label>
        <input type="text" id="senha" class="senha" placeholder="Digite a senha" />
      </div>
      <button onclick="cadastrar(event)" type="submit" id="cadastrarUsuario" class="button-cadastrarUsuario">
        Concluído
      </button>
    </form>
  </div>
</dialog>

<dialog id="popupAdicionarMoedas" class="popupAdicionarMoedas">
  <header class="headerCentral-ListaDeUsuario">
      <div class="headerLogo-ListaDeUsuario">
          <img src="{% static "img/logoAdmin.png" %}" alt="LOGO">
      </div>
      <div class="headerBotao-ListaDeUsuario">
          <button type="button" class="buttonClose-ListaDeUsuario">    
              <img id="fecharAdicionarMoedas"  alt="botãoClose" src="{% static "img/iconeX.png" %}">
          </button>
      </div>
  </header>
  <div class="ModalContainer-ListaDeUsuario">
    <form class="formAdicionarMoedas" id="formAdicionarMoedas">
      {% csrf_token %}
      <div class="gerenciarDigicoins-adicionarMoedas">
        <h1>Gerenciar digicoins</h1>
        <div class="quantidade-adicionarMoedas">
          <label>Quantidade a ser adicionada ou removida</label>
          <input class="quantidadeInput-adicionarMoedas pontuacao-input-pontual" id="saldo" type="text" placeholder="5.000" onkeydown="return bloqueiaCaracteresIndesejados(event)"/>
        </div>
      </div> 
      <div class="botoes-adicionarMoedas">
        <button class="adicionar-adicionarMoedas" id="adicionar">
          Adicionar
        </button>
        <button class="remover-adicionarMoedas" id="remover">Remover</button>
      </div>
    </form>
  </div>
</dialog>

<dialog id="popupUsuariosEmMassa" class="popupUsuariosEmMassa">
  <header class="headerCentral-ListaDeUsuario">
    <div class="headerLogo-ListaDeUsuario">
      <img src="{% static "img/logoAdmin.png" %}" alt="LOGO">
    </div>
    <div class="headerBotao-ListaDeUsuario">
      <button  id="fecharUsuariosEmMassa" type="button" class="buttonClose-ListaDeUsuario">    
        <img alt="botãoClose" src="{% static "img/iconeX.png" %}">
      </button>
    </div>
  </header>
  <div class="header-container">
    <h3>Selecione um arquivo CSV para cadastrar usuários em massa</h3>
  </div>

  <form id="formUsuariosEmMassa" method="dialog">
    {% csrf_token %}
    <label for="csvFileInput">Arquivo CSV:</label>
    <input type="file" id="csvFileInput" name="csv_file" accept=".csv" />
    <button type="submit">Enviar</button>

     <a class='downloadCsv'
      href="{% static 'modelos/modelo_usuarios.csv' %}" 
      download="modelo_usuarios.csv"
      >
      <img src="{% static 'img/export.png' %}" alt="Exportar" style="width: 28px; height: 28px;">
      Baixar modelo CSV
  </a>
  </form>
</dialog>


<script src="{% static 'js/AdmJS/listaDeUsuarios.js' %}"></script>
<script src="{% static 'js/AdmJS/cadastrarUsuario.js' %}"></script>
<script src="{% static 'js/AdmJS/mascara.js' %}"></script>
{% endblock %}