{% extends "base.html" %}
{% load static %}
{% block content %}
{% include 'components/adm/menuAdm.html' %}


<link rel="stylesheet" href="{% static 'css/AdmCss/relatorio.css' %}">
<div class="container-relatorio">
    <div class="cabecalho-relatorio">
        <div class="cabecalho_titulo-relatorio">
            <h1><span>Rela</span>tórios</h1>
        </div>
        <div class="cabecalho_btnexportar-relatorio">
            <button id="exportButton"><img src="{% static 'img/export.png' %}" alt="Exportar" style="width: 28px; height: 28px;">Exportar</button>
        </div>
    </div>
    <div class="relatorio">
        <table class="tabela_relatorio">
            <tbody  class="tabela_relatorio_body">
                <tr class="linha-relatorio" data-checkbox-id="vendasCheckbox">
                    <td class="tabela_relatorio_conteudo-relatorio">
                        <div class="tabela_relatorio_conteudo_checkbox-relatorio">
                            <input type="checkbox" id="vendasCheckbox" name="checkbox" />
                            <label for="vendasCheckbox"></label>
                        </div>
                        <div class="tabela_relatorio_conteudo_dado-relatorio">
                            <img src="{% static 'img/relatorio.png' %}" alt="Relatório">
                            <span class="tabela_relatorio_conteudo_dado-relatorio-titulo">Vendas</span>
                        </div>
                    </td>
                </tr>
                <tr class="linha-relatorio" data-checkbox-id="produtosMaisVendidosCheckbox">
                    <td class="tabela_relatorio_conteudo-relatorio">
                        <div class="tabela_relatorio_conteudo_checkbox-relatorio">
                            <input type="checkbox" id="produtosMaisVendidosCheckbox" name="checkbox" />
                            <label for="produtosMaisVendidosCheckbox"></label>
                        </div>
                        <div class="tabela_relatorio_conteudo_dado-relatorio">
                            <img src="{% static 'img/relatorio.png' %}" alt="Relatório">
                            <span class="tabela_relatorio_conteudo_dado-relatorio-titulo">Produtos mais vendidos</span>
                        </div>
                    </td>
                </tr>
                <tr class="linha-relatorio" data-checkbox-id="usuariosMaisMoedasCheckbox">
                    <td class="tabela_relatorio_conteudo-relatorio">
                        <div class="tabela_relatorio_conteudo_checkbox-relatorio">
                            <input type="checkbox" id="usuariosMaisMoedasCheckbox" name="checkbox" />
                            <label for="usuariosMaisMoedasCheckbox"></label>
                        </div>
                        <div class="tabela_relatorio_conteudo_dado-relatorio">
                            <img src="{% static 'img/relatorio.png' %}" alt="Relatório">
                            <span class="tabela_relatorio_conteudo_dado-relatorio-titulo">Usuários com mais moedas</span>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const checkboxes = document.querySelectorAll("input[name=\"checkbox\"]");
        const linhasRelatorio = document.querySelectorAll(".linha-relatorio"); // Seleciona todas as linhas

        // Lógica original para garantir que apenas uma checkbox esteja selecionada
        checkboxes.forEach(function(checkbox) {
            checkbox.addEventListener("change", function() {
                if (this.checked) {
                    checkboxes.forEach(function(otherCheckbox) {
                        if (otherCheckbox !== checkbox) {
                            otherCheckbox.checked = false;
                        }
                    });
                }
            });
        });

        // NOVA LÓGICA: Selecionar a checkbox ao clicar na linha
        linhasRelatorio.forEach(function(linha) {
            linha.addEventListener("click", function(event) {
                const checkboxId = linha.getAttribute("data-checkbox-id");
                const checkbox = document.getElementById(checkboxId);

                // Se o clique não foi diretamente no input ou label, alternar o estado da checkbox
                // Isso evita que o clique duplo ocorra (um pelo evento na linha e outro no input/label)
                if (event.target !== checkbox && event.target.tagName !== 'LABEL') {
                    checkbox.checked = !checkbox.checked;

                    // Acionar o evento 'change' da checkbox para executar a lógica de desmarcação das outras
                    const changeEvent = new Event('change');
                    checkbox.dispatchEvent(changeEvent);
                }
            });
        });


        // Lógica de exportação original
        document.getElementById("exportButton").addEventListener("click", function() {
            var vendasChecked = document.getElementById("vendasCheckbox").checked;
            var produtosMaisVendidosChecked = document.getElementById("produtosMaisVendidosCheckbox").checked;
            var usuariosMaisMoedasChecked = document.getElementById("usuariosMaisMoedasCheckbox").checked;
            const popupAlert = new Popup();
            if (vendasChecked) {
                window.location.href = "/api/exportar_vendas_excel/";
            } else if (produtosMaisVendidosChecked) {
                window.location.href = "/api/exportar_produtos_mais_vendidos_excel/";
            } else if (usuariosMaisMoedasChecked) {
                window.location.href = "/api/exportar_usuarios_com_mais_moedas_excel/";
            } else {
                popupAlert.showPopup("Por favor, selecione uma opção para exportar.", "Erro", "erro");
            }
        });
    });
</script>

{% endblock content %}